/********************************************************************************************************/
/************************************************Includes************************************************/
/********************************************************************************************************/

#include "MCAL/STK/STK.h"
#include "Sched.h"

/********************************************************************************************************/
/************************************************Defines*************************************************/
/********************************************************************************************************/

#define Tick 1


/********************************************************************************************************/
/************************************************Types***************************************************/
/********************************************************************************************************/



/********************************************************************************************************/
/************************************************Variables***********************************************/
/********************************************************************************************************/

extern Runnable_t Runnabls [_Max_Num];

volatile static u32 PendingTicks=0;


/********************************************************************************************************/
/*****************************************Static Functions Prototype*************************************/
/********************************************************************************************************/

static  void Sched (void)
{
   u8 Indx;
   for(Indx=0; Indx <_Max_Num;Indx++)
   {
     if (Runnabls[Indx].FirstDelay==0)
     { 
       Runnabls[Indx].FirstDelay= Runnabls[Indx].Periodicty-1;
       Runnabls[Indx].Callback();
     }
     else
     {
        Runnabls[Indx].FirstDelay-=Tick;
     }
   }



}


void TickCB (void)
{
   PendingTicks++;
}


/********************************************************************************************************/
/*********************************************APIs Implementation****************************************/
/********************************************************************************************************/

void Sched_Init(void)
{
    STK_Init();
}

void Sched_Start(void)
{
    STK_SetTimePeriodic_ms(Tick,TickCB);
    while (1)
    {
       if(PendingTicks)
        {
          PendingTicks--;
          Sched();
        }
    }
    
    
}